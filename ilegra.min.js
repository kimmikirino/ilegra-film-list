'use strict';
/* global angular, confirm */

var ilegra = angular.module('ilegra', [
  'ngRoute',
  'compiledTemplates',
  'ilegraServices',
  'appConfig'
]);

ilegra.config(['$routeProvider', '$httpProvider',
    function($routeProvider, $httpProvider) {
        $httpProvider.defaults.withCredentials = false;

        $routeProvider
            .when('/films', {
                templateUrl: 'components/films.html',
                controller: 'filmsController'
            })
            .otherwise({
              redirectTo: '/films'
            });
    }
]);

ilegra.run(['$rootScope', '$location', function($rootScope, $location) {
}]);

/************************************************************************************************
 * Controllers
 ************************************************************************************************/
ilegra.controller('filmsController', ['$scope', '$rootScope', 'ilegraServices',
  function( $scope, $rootScope, ilegraServices) {
    const episode = ['', 'I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];
    $scope.show = false;
    $scope.loading = true;

    $scope.getEpisode = function(ep) {
      return episode[ep];
    };

    $scope.convertDate = function(createdDate) {
      const date = new Date(createdDate);
      return date.getDay() + '/' + (date.getMonth()+1) + '/' + date.getFullYear(); 
    };

    $scope.showModal = function() {
      $scope.show = !$scope.show; 
      if ($scope.show) {
        $("body").addClass("modal-open");
      } else {
        $("body").removeClass("modal-open");
      }
    };

    $scope.isLoading = function() {
      $scope.loading = !$scope.loading;
    };

    $scope.seeChars = function(chars, title) {
      $scope.isLoading();
      $scope.characters = [];
      $scope.title = title;
      chars.map(function(char) {
        ilegraServices.getAll(char).$promise.then(function(data){
          $scope.characters.push(data);
          if ($scope.characters.length === chars.length) {
            $scope.isLoading();
            $scope.showModal();

          }
        });
      });
    };

    ilegraServices.getFilms().$promise.then(function(data) {
      $scope.films = data.results;
      $scope.isLoading();
    });
  }]);

'use strict';
/* global angular, $http, topicType, apontadorConfig */
var ilegraServices = angular.module('ilegraServices', ['ngResource', 'appConfig']);

ilegraServices.service('ilegraServices', ['$resource', 'ilegraConfig', function($resource, ilegraConfig){
    this.getFilms = function () {
        return $resource(
            ilegraConfig.endpoint
        ).get();
    };

    this.getAll = function(route) {
        return $resource(
            route
        ).get();
    };
}]);

'use strict';
/* global angular */

var ilegra = angular.module('ilegra');

ilegra.directive('pageHeader', ['$rootScope', '$location',  function ( $rootScope, $location) {
    return {
        restrict: 'E',
        templateUrl:  'assets/directives/header.html',
        replace: true,
        link: function (scope, iElm, iAttrs, controller) {
        }
    };
}]);

angular.module('compiledTemplates', []).run(['$templateCache', function($templateCache) {
  'use strict';

  $templateCache.put('assets/directives/header.html',
    "<header class=\"page-header container\"><a class=page-header__brand href=#/ ><img src=assets/images/about-logo.png alt=\"Ilegra Logo\"></a><h2 class=page-header__title>Films</h2></header>"
  );


  $templateCache.put('components/films.html',
    "<section class=\"container film\"><div class=loader-box ng-show=loading><div class=loader></div></div><div class=card ng-repeat=\"film in ::films | orderBy: 'episode_id' track by film.episode_id\"><img class=card-img-top src=../assets/images/starwars.png alt=\"Card image cap\"><div class=card-block><h3 class=card-header>{{film.title}}</h3><h4 class=\"card-title card-pad\">Episode: {{getEpisode(film.episode_id)}}</h4><p class=\"card-text card-pad\"><small><b>Release date:</b> {{convertDate(film.release_date)}}</small></p><p class=\"card-text card-pad\"><b>Opening:</b> {{film.opening_crawl}}</p><p class=\"card-text card-pad\"><b>Created:</b> {{convertDate(film.created)}}</p><p class=\"card-text card-pad\"><b><button class=\"btn btn-dark\" ng-click=\"seeChars(film.characters, film.title)\">See chars</button></b></p><p class=\"card-text card-pad\"><small><b>Director:</b> {{film.director}}</small></p><p class=\"card-text card-pad\"><small><b>Producer:</b> {{film.producer}}</small></p></div></div><div class=\"modal modal-films\" aria-labelledby=charsModallLabel aria-hidden=true ng-show=show><div class=modal-dialog role=document><div class=\"modal-content modal-lg\"><div class=modal-header><h5 class=modal-title id=charsModallLabel>{{title}} Characters</h5><button type=button class=close ng-click=showModal()><span aria-hidden=true>&times;</span></button></div><div class=modal-body><table class=table><thead><tr><th scope=col>Name</th><th scope=col>Birth Year</th><th scope=col>Skin Color</th><th scope=col>Height</th></tr></thead><tbody><tr ng-repeat=\"char in characters track by $index\"><td>{{char.name}}</td><td>{{char.birth_year}}</td><td>{{char.skin_color}}</td><td>{{char.height}}</td></tr></tbody></table></div><div class=modal-footer><button type=button class=\"btn btn-secondary\" ng-click=showModal()>Close</button></div></div></div></div></section>"
  );


  $templateCache.put('index.html',
    "<!DOCTYPE html><html lang=en ng-app=ilegra><head><meta charset=UTF-8><meta name=viewport content=\"width=device-width,initial-scale=1\"><title>Ilegra</title><link href=\"https://fonts.googleapis.com/css?family=Roboto:400,600,700,800\" rel=stylesheet><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css integrity=sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm crossorigin=anonymous><link rel=stylesheet href=assets/main.css><script src=jquery-3.3.1.min.js></script><script src=angular-1.6.9/angular.min.js></script><script src=angular-1.6.9/angular-route.min.js></script><script src=angular-1.6.9/angular-resource.min.js></script><script src=angular-1.6.9/i18n/angular-locale_pt-br.js></script><script src=angular-1.6.9/angular-cookies.min.js></script><script src=ilegra.js></script><script src=ilegraServices.js></script><script src=assets/directives/ilegra-directives.js></script><script src=templates.js></script><script src=Config.js></script></head><body><page-header></page-header><main ng-view></main></body></html>"
  );

}]);
